{% extends "base.html" %}

{% block title %}{{ center.name }} - EduMarket{% endblock %}

{% block content %}
<div class="center-detail-hero">
    <div class="container">
        <div class="center-header">
            <div class="center-logo-large">
                {% if center.logo %}
                    <img src="{{ url_for('static', filename='uploads/centers/' + center.logo) }}" alt="{{ center.name }}">
                {% else %}
                    <i class="fas fa-graduation-cap"></i>
                {% endif %}
            </div>
            <div class="center-header-info">
                <h1>{{ center.name }}</h1>
                <div class="center-meta">
                    <div class="meta-item">
                        <i class="fas fa-star"></i>
                        <strong>{{ "%.1f"|format(center.rating) }}</strong> reyting
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-users"></i>
                        <strong>{{ center.student_count }}</strong> o'quvchi
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-book-open"></i>
                        <strong>{{ subjects|length }}</strong> fan
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="center-detail-grid">
        <!-- Main Content -->
        <div class="main-content">
            <!-- About -->
            <section class="detail-section">
                <h2><i class="fas fa-info-circle"></i> Markaz haqida</h2>
                <p>{{ center.description or 'Tavsif mavjud emas' }}</p>
            </section>
            
            <!-- Subjects -->
            <section class="detail-section" id="subjects">
                <h2><i class="fas fa-book"></i> Fanlar</h2>
                <div class="subjects-grid">
                    {% for subject in subjects %}
                    <div class="subject-card">
                        <div class="subject-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3>{{ subject.name }}</h3>
                        <p>{{ subject.description or 'Tavsif mavjud emas' }}</p>
                        <div class="subject-meta">
                            <span><i class="fas fa-money-bill"></i> {{ "{:,.0f}".format(subject.price) }} so'm</span>
                            <span><i class="fas fa-calendar"></i> {{ subject.duration_months }} oy</span>
                        </div>
                        <button class="btn-enroll" onclick="enrollSubject({{ subject.id }})">
                            <i class="fas fa-user-plus"></i> Ro'yxatdan o'tish
                        </button>
                    </div>
                    {% endfor %}
                </div>
            </section>
            
            <!-- Teachers -->
            <section class="detail-section">
                <h2><i class="fas fa-chalkboard-teacher"></i> O'qituvchilar</h2>
                <div class="teachers-grid">
                    {% for teacher in teachers %}
                    <div class="teacher-card">
                        <div class="teacher-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <h3>{{ teacher.full_name }}</h3>
                        <p class="teacher-subject">{{ teacher.subject_name or 'Fan ko\'rsatilmagan' }}</p>
                        <p class="teacher-exp">
                            <i class="fas fa-briefcase"></i> {{ teacher.experience_years }} yil tajriba
                        </p>
                        <div class="teacher-kpi">
                            <div class="kpi-item">
                                <strong>{{ teacher.kpi_successful_students }}</strong>
                                <span>Muvaffaqiyatli</span>
                            </div>
                            <div class="kpi-item">
                                <strong>{{ "%.1f"|format(teacher.kpi_rating) }}</strong>
                                <span>Reyting</span>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            
            <!-- Reviews -->
            <section class="detail-section">
                <h2><i class="fas fa-star"></i> Sharhlar ({{ reviews|length }})</h2>
                <div class="reviews-list">
                    {% for review in reviews %}
                    <div class="review-item">
                        <div class="review-header">
                            <strong>{{ review.full_name }}</strong>
                            <div class="review-rating">
                                {% for i in range(review.rating) %}
                                <i class="fas fa-star"></i>
                                {% endfor %}
                            </div>
                        </div>
                        <p>{{ review.comment }}</p>
                        <small>{{ review.created_at }}</small>
                    </div>
                    {% endfor %}
                </div>
            </section>
        </div>
        
        <!-- Sidebar -->
        <aside class="detail-sidebar">
            <div class="contact-card">
                <h3><i class="fas fa-phone"></i> Aloqa</h3>
                <div class="contact-info">
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>{{ center.address or 'Manzil ko\'rsatilmagan' }}</span>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <a href="tel:{{ center.phone }}">{{ center.phone or 'N/A' }}</a>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <a href="mailto:{{ center.email }}">{{ center.email or 'N/A' }}</a>
                    </div>
                    {% if center.website %}
                    <div class="contact-item">
                        <i class="fas fa-globe"></i>
                        <a href="{{ center.website }}" target="_blank">{{ center.website }}</a>
                    </div>
                    {% endif %}
                </div>
                
                <a href="#enroll" class="btn-contact-action">
                    <i class="fas fa-user-plus"></i> Ro'yxatdan o'tish
                </a>
            </div>
            
            {% if center.latitude and center.longitude %}
            <div class="map-card">
                <h3><i class="fas fa-map"></i> Joylashuv</h3>
                <div id="miniMap" style="height: 200px; border-radius: 8px;"></div>
            </div>
            {% endif %}
        </aside>
    </div>
</div>
{% endblock %}

{% block scripts %}
{% if center.latitude and center.longitude %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const miniMap = L.map('miniMap').setView([{{ center.latitude }}, {{ center.longitude }}], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
L.marker([{{ center.latitude }}, {{ center.longitude }}]).addTo(miniMap);
</script>
{% endif %}

<script>
function enrollSubject(subjectId) {
    {% if session.user_id %}
        if (confirm('Bu fanga ro\'yxatdan o\'tmoqchimisiz?')) {
            // Here you would make an API call to enroll
            alert('Ro\'yxatdan o\'tish so\'rovi yuborildi!');
        }
    {% else %}
        alert('Ro\'yxatdan o\'tish uchun tizimga kiring!');
        window.location.href = '{{ url_for("login") }}';
    {% endif %}
}
</script>
{% endblock %}
