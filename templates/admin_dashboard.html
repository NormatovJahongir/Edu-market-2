{% extends "base.html" %}

{% block title %}Admin Dashboard - EduMarket{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-user-circle"></i>
            <div>
                <h4>{{ session.full_name }}</h4>
                <p>{{ 'Super Admin' if session.role == 'super_admin' else 'Markaz Admini' }}</p>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="{{ url_for('admin_dashboard') }}" class="nav-item active">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            {% if session.role == 'super_admin' %}
            <a href="#" class="nav-item">
                <i class="fas fa-school"></i> Markazlar
            </a>
            {% endif %}
            <a href="#" class="nav-item">
                <i class="fas fa-users"></i> O'quvchilar
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-chalkboard-teacher"></i> O'qituvchilar
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-book"></i> Fanlar
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-money-bill"></i> To'lovlar
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-calendar-check"></i> Davomat
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-chart-bar"></i> Natijalar
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-bell"></i> Bildirishnomalar
            </a>
        </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="dashboard-header">
            <h1><i class="fas fa-tachometer-alt"></i> Boshqaruv paneli</h1>
            <div class="header-actions">
                <button class="btn-icon" title="Yangilanish">
                    <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn-icon" title="Sozlamalar">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
        
        <!-- Statistics Cards -->
        <div class="stats-row">
            <div class="stat-box blue">
                <div class="stat-icon">
                    <i class="fas fa-school"></i>
                </div>
                <div class="stat-details">
                    <h3>{{ total_centers }}</h3>
                    <p>O'quv markazlari</p>
                </div>
            </div>
            
            <div class="stat-box green">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-details">
                    <h3>{{ total_students }}</h3>
                    <p>O'quvchilar</p>
                </div>
            </div>
            
            <div class="stat-box orange">
                <div class="stat-icon">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="stat-details">
                    <h3>{{ total_teachers }}</h3>
                    <p>O'qituvchilar</p>
                </div>
            </div>
            
            <div class="stat-box purple">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-details">
                    <h3>{{ "{:,.0f}".format(total_revenue) }} so'm</h3>
                    <p>Umumiy daromad</p>
                </div>
            </div>
        </div>
        
        <!-- Charts Row -->
        <div class="charts-row">
            <div class="chart-card">
                <h3><i class="fas fa-chart-line"></i> O'quvchilar dinamikasi</h3>
                <canvas id="studentsChart"></canvas>
            </div>
            
            <div class="chart-card">
                <h3><i class="fas fa-chart-pie"></i> To'lovlar statistikasi</h3>
                <canvas id="paymentsChart"></canvas>
            </div>
        </div>
        
        <!-- Top Centers -->
        <div class="data-card">
            <div class="card-header">
                <h3><i class="fas fa-trophy"></i> Eng yaxshi markazlar</h3>
                <a href="#" class="view-all">Barchasini ko'rish <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Markaz nomi</th>
                            <th>Reyting</th>
                            <th>O'quvchilar</th>
                            <th>O'rtacha natija</th>
                            <th>Holat</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for center in top_centers %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>
                                <div class="center-cell">
                                    <strong>{{ center.name }}</strong>
                                </div>
                            </td>
                            <td>
                                <div class="rating-cell">
                                    <i class="fas fa-star"></i>
                                    {{ "%.1f"|format(center.rating) }}
                                </div>
                            </td>
                            <td>{{ center.student_count or 0 }}</td>
                            <td>{{ "%.1f"|format(center.avg_results) }}%</td>
                            <td>
                                <span class="status-badge {{ center.status }}">
                                    {{ center.status }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Recent Payments -->
        <div class="data-card">
            <div class="card-header">
                <h3><i class="fas fa-receipt"></i> So'nggi to'lovlar</h3>
                <a href="#" class="view-all">Barchasini ko'rish <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>O'quvchi</th>
                            {% if session.role == 'super_admin' %}
                            <th>Markaz</th>
                            {% endif %}
                            <th>Summa</th>
                            <th>Turi</th>
                            <th>Sana</th>
                            <th>Holat</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in recent_payments %}
                        <tr>
                            <td>#{{ payment.id }}</td>
                            <td>{{ payment.full_name }}</td>
                            {% if session.role == 'super_admin' %}
                            <td>{{ payment.center_name }}</td>
                            {% endif %}
                            <td>{{ "{:,.0f}".format(payment.amount) }} so'm</td>
                            <td>{{ payment.payment_type }}</td>
                            <td>{{ payment.payment_date }}</td>
                            <td>
                                <span class="status-badge {{ payment.status }}">
                                    {{ payment.status }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Students Chart
const studentsCtx = document.getElementById('studentsChart').getContext('2d');
new Chart(studentsCtx, {
    type: 'line',
    data: {
        labels: ['Yan', 'Fev', 'Mar', 'Apr', 'May', 'Iyun'],
        datasets: [{
            label: 'O\'quvchilar soni',
            data: [120, 190, 230, 280, 350, 420],
            borderColor: '#4F46E5',
            backgroundColor: 'rgba(79, 70, 229, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});

// Payments Chart
const paymentsCtx = document.getElementById('paymentsChart').getContext('2d');
new Chart(paymentsCtx, {
    type: 'doughnut',
    data: {
        labels: ['To\'langan', 'Kutilmoqda', 'Kechikkan'],
        datasets: [{
            data: [65, 25, 10],
            backgroundColor: ['#10B981', '#F59E0B', '#EF4444']
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
</script>
{% endblock %}
