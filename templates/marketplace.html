{% extends "base.html" %}

{% block title %}Marketplace - EduMarket{% endblock %}

{% block content %}
<div class="marketplace-hero">
    <div class="container">
        <h1 class="hero-title">
            <i class="fas fa-store"></i>
            O'quv markazlari bozori
        </h1>
        <p class="hero-subtitle">Eng yaxshi o'quv markazlarini toping va ro'yxatdan o'ting!</p>
        
        <!-- Search and Filter -->
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Markaz nomi, fan yoki manzil bo'yicha qidiring..." class="search-input">
            <button class="btn-search" onclick="searchCenters()">
                <i class="fas fa-search"></i> Qidirish
            </button>
        </div>
        
        <div class="filters">
            <select id="subjectFilter" class="filter-select">
                <option value="">Barcha fanlar</option>
                <option value="matematika">Matematika</option>
                <option value="ingliz">Ingliz tili</option>
                <option value="fizika">Fizika</option>
                <option value="kimyo">Kimyo</option>
                <option value="dasturlash">Dasturlash</option>
            </select>
            
            <select id="ratingFilter" class="filter-select">
                <option value="">Reyting bo'yicha</option>
                <option value="high">Yuqori reyting</option>
                <option value="low">Past reyting</option>
            </select>
            
            <button class="btn-filter" onclick="applyFilters()">
                <i class="fas fa-filter"></i> Filtrlash
            </button>
        </div>
    </div>
</div>

<div class="container">
    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-school stat-icon"></i>
            <div class="stat-info">
                <h3>{{ centers|length }}</h3>
                <p>O'quv markazlari</p>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-users stat-icon"></i>
            <div class="stat-info">
                <h3>{{ centers|sum(attribute='total_students') }}</h3>
                <p>O'quvchilar</p>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-book stat-icon"></i>
            <div class="stat-info">
                <h3>{{ centers|sum(attribute='total_subjects') }}</h3>
                <p>Fanlar</p>
            </div>
        </div>
        <div class="stat-card">
            <i class="fas fa-star stat-icon"></i>
            <div class="stat-info">
                <h3>{% if centers %}{{ "%.1f"|format(centers|sum(attribute='rating')/centers|length) }}{% else %}0{% endif %}</h3>
                <p>O'rtacha reyting</p>
            </div>
        </div>
    </div>

    <!-- Centers Grid -->
    <div class="section-header">
        <h2><i class="fas fa-fire"></i> Eng mashhur markazlar</h2>
    </div>
    
    <div class="centers-grid" id="centersGrid">
        {% if centers %}
            {% for center in centers %}
            <div class="center-card" data-rating="{{ center.rating }}">
                <div class="card-header">
                    {% if center.logo %}
                        <img src="{{ url_for('static', filename='uploads/centers/' + center.logo) }}" alt="{{ center.name }}" class="center-logo">
                    {% else %}
                        <div class="center-logo-placeholder">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                    {% endif %}
                    <div class="rating-badge">
                        <i class="fas fa-star"></i>
                        {{ "%.1f"|format(center.rating) }}
                    </div>
                </div>
                
                <div class="card-body">
                    <h3 class="center-name">{{ center.name }}</h3>
                    <p class="center-description">
    {% if center.description %}
        {{ center.description[:100] }}...
    {% else %}
        Tavsif mavjud emas.
    {% endif %}
</p>
                    
                    <div class="center-info">
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ center.address or 'Manzil ko\'rsatilmagan' }}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-users"></i>
                            <span>{{ center.total_students }} o'quvchi</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-book-open"></i>
                            <span>{{ center.total_subjects }} fan</span>
                        </div>
                    </div>
                </div>
                
                <div class="card-footer">
                    <a href="{{ url_for('center_detail', center_id=center.id) }}" class="btn-primary">
                        <i class="fas fa-info-circle"></i> Batafsil
                    </a>
                    <a href="{{ url_for('center_detail', center_id=center.id) }}#enroll" class="btn-success">
                        <i class="fas fa-user-plus"></i> Ro'yxatdan o'tish
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-results">
                <i class="fas fa-search"></i>
                <p>Hozircha markazlar mavjud emas</p>
            </div>
        {% endif %}
    </div>
    
    <!-- Call to Action -->
    <div class="cta-section">
        <div class="cta-content">
            <h2>O'quv markazingizni ro'yxatdan o'tkazing!</h2>
            <p>Minglab o'quvchilarga erishing va biznessingizni rivojlantiring</p>
            <a href="{{ url_for('login') }}" class="btn-cta">
                <i class="fas fa-rocket"></i> Hoziroq boshlash
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function searchCenters() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const cards = document.querySelectorAll('.center-card');
    
    cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

function applyFilters() {
    const ratingFilter = document.getElementById('ratingFilter').value;
    const cards = Array.from(document.querySelectorAll('.center-card'));
    
    if (ratingFilter === 'high') {
        cards.sort((a, b) => {
            return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
        });
    } else if (ratingFilter === 'low') {
        cards.sort((a, b) => {
            return parseFloat(a.dataset.rating) - parseFloat(b.dataset.rating);
        });
    }
    
    const grid = document.getElementById('centersGrid');
    cards.forEach(card => grid.appendChild(card));
}

// Real-time search
document.getElementById('searchInput').addEventListener('input', searchCenters);
</script>
{% endblock %}
